<analysis>**original_problem_statement:**
The user has provided a comprehensive audit and refactoring request for the Nex-Store-main (Free Fire top-up) project. The goal is to audit, fix, and clean up the entire system (backend + frontend) to close all loopholes and align it with a detailed set of business logic requirements.

**PRODUCT REQUIREMENTS:**

1.  **Unified Order System:** All transactions (product top-ups and wallet loads) must be visible in a single, clean Orders system. Wallet loads must create an  record with an  of wallet_load.
2.  **Wallet & Payment Safety:**
    *   All monetary values must be stored and processed as integers (paisa/cents) to avoid floating-point errors.
    *   Overpayment logic must be robust: credit the exact extra amount to the user's wallet.
    *   Add sanity checks for unusually large overpayments, flagging them for manual review instead of auto-crediting.
3.  **UI/UX Overhaul:**
    *   Fix all UI readability issues, specifically white text on white/light backgrounds.
    *   Standardize the entire application design to a strict Garena theme (white/orange/red).
    *   Update user navigation to include Top-Up, a unified Orders page, and Wallet.
4.  **Admin Capabilities:**
    *   Admin must be able to review, edit, and manually fulfill any order.
    *   Implement a manual review queue for suspicious transactions, failed automation, etc.
    *   Admin must be able to manage Garena automation accounts (add/edit/delete/secure PIN).
5.  **Robust Order States & Automation:**
    *   Implement a comprehensive set of order statuses (, , , , , , , , , , ).
    *   Handle automation failures gracefully (e.g., invalid UID, Garena site changes).
    *   Ensure automation logs out of previous sessions to prevent top-ups to wrong accounts.
6.  **Improved Payment Matching:**
    *   Enforce payment used once by creating a unique index on the payment RRN and a  fingerprint of the raw SMS message.
    *   Implement logic to auto-match pre-existing unmatched SMS messages to newly created orders.
    *   Flag SMS messages that remain unmatched for over an hour as suspicious.
7.  **Payment Rounding Policy:**
    *   Implement a new rounding policy: round up to the nearest 1 (<100), nearest 5 (100-500), or nearest 10 (>500).

**User's preferred language**: English

**what currently exists?**
A full-stack application with a FastAPI backend and a React frontend. The agent has just begun a massive backend refactoring process based on a new, comprehensive set of user requirements. A new, empty file  has been created with the intention of replacing the monolith . The frontend has undergone several UI fixes but still has significant readability issues and requires further alignment with the new backend APIs and user requirements. An Android SMS forwarder app project has been scaffolded but is not integrated or tested. The application is currently in a non-functional, transitional state pending the completion of the refactor.

**Last working item**:
- **Last item agent was working:** The agent initiated a complete backend overhaul as requested by the user. It created a new file, , to house the refactored code that will address all new requirements, including unified orders, integer-based currency, and improved payment logic. The final action was to begin replacing the old server file with the new one.
- **Status:** IN PROGRESS
- **Agent Testing Done:** N
- **Which testing method agent to use?** both
- **User Testing Done:** N

**All Pending/In progress Issue list**:
- **Issue 1:** The entire application requires a comprehensive audit and refactor to meet the new, detailed user requirements. (PRIORITY: P0)

**Issues Detail:**
- **Issue 1:**
    - **Description:** The current codebase does not meet the user's detailed requirements for order management, payment safety, UI consistency, and admin functionality. Major architectural changes are needed.
    - **Attempted fixes:** The agent started the refactor by creating a new backend file .
    - **Next debug checklist:**
        1.  Implement all backend logic from the user's requirements () in . This includes:
            - Using integers for all currency values (/).
            - Creating a unified  collection with an  field.
            - Implementing the new payment rounding policy.
            - Adding robust payment matching with RRN and SMS fingerprint uniqueness.
            - Defining all new order statuses and their transition logic.
            - Adding all required admin endpoints (dashboard, order management, review queues).
        2.  Replace the old  with the new file and ensure the backend service runs correctly.
        3.  Refactor the entire frontend to fix UI readability issues, align with the new Garena color scheme, and integrate with the new backend APIs.
        4.  Specifically target and fix , , , and  pages.
    - **Why fix this issue and what will be achieved with the fix?** This will transform the application from a prototype into a robust, secure, and user-friendly platform that aligns with the core business logic, closing security loopholes and improving operational efficiency.
    - **Status:** IN PROGRESS
    - **Is recurring issue?** N
    - **Should Test frontend/backend/both after fix?** both
    - **Blocked on other issue:** None. This is the primary task.

**In progress Task List**:
- **Task 1:** Complete the backend refactoring. (PRIORITY: P0)
  - **Where to resume:** Populate the empty  file with the completely refactored backend code according to the user's detailed requirements.
  - **What will be achieved with this?** A stable, secure, and feature-complete backend API that serves as the foundation for the application.
  - **Status:** IN PROGRESS
  - **Should Test frontend/backend/both after fix?** Backend.
  - **Blocked on something:** Nothing.

**Upcoming and Future Tasks**
**Upcoming Tasks:**
- **P0: Backend Implementation in :**
    - **Data Model:** Convert all currency fields (, , etc.) to integers ().
    - **Orders:** Unify  and  into a single  collection with an  field.
    - **Payment Logic:** Implement the new rounding policy and robust overpayment handling.
    - **Payment Matching:** Add  for uniqueness and logic to match pre-existing SMS messages.
    - **Statuses:** Implement the full list of new order statuses (, , , etc.).
    - **Admin API:** Create endpoints for the new admin dashboard analytics, order editing, and manual review queues.
- **P1: Frontend Overhaul:**
    - **UI Fixes:** Systematically remove all  on light backgrounds and standardize text colors to /.
    - **API Integration:** Connect the frontend to the new  backend endpoints.
    - **Pages:** Rebuild the , , and payment flow pages to align with the new unified order system and UI standards.
- **P2: End-to-End Flow Testing:**
    - Test the complete user journey: order creation -> SMS payment -> overpayment wallet credit -> successful automation.
    - Test edge cases: invalid UID, suspicious payments, manual order fulfillment.

**Future Tasks:**
- **P3: Android SMS Forwarder Integration:**
    - Provide a build script for the created Android app.
    - Test the app's ability to forward SMS messages to the backend  endpoint.

**Completed work in this session**
- **Backend Bug Fixes & Features:**
    - Resolved a critical  that was blocking the backend from starting.
    - Implemented payment logic for rounding prices and handling overpayments by crediting the user's wallet.
    - Created an admin endpoint and UI () for manually inputting and matching payment SMS messages.
    - Improved the SMS parsing regex to correctly extract phone digits.
- **Frontend UI Overhaul:**
    - Fixed a  build error.
    - Applied a consistent Garena-style (white/orange/red) theme to , , , and  pages.
    - Created a new  page with a detail view and added the corresponding backend endpoint.
    - Fixed numerous UI readability issues (e.g., dark text on light backgrounds) on the , , and  pages.
- **New Components:**
    - Scaffolded a complete Android Studio project for an SMS forwarding application in .

**Earlier issues found/mentioned but not fixed**
- All previously identified issues are now encapsulated within the comprehensive audit and refactoring task requested by the user in . The entire application is considered unfixed relative to these new, detailed requirements.

**Known issue recurrence from previous fork**
- None.

**Code Architecture**


**Key Technical Concepts**
- **Backend:** FastAPI, MongoDB (via Pymongo)
- **Frontend:** React, Tailwind CSS
- **Authentication:** JWT
- **Automation:** Playwright with 
- **Architecture:** The backend is moving from a single monolithic file to a refactored, more organized structure. A key change is the switch to integer-based currency for all financial calculations.

**key DB schema**
*(Proposed changes based on user requirements)*
- **users:** 
- **orders:** 
- **sms_messages:** 
- **wallet_transactions:** 

**changes in tech stack**
- None in the core web application. An auxiliary Android application project was created.

**All files of reference**
- : The new, empty file where the entire backend refactor must be implemented.
- : The existing legacy backend code that needs to be replaced.
- : The directory containing all frontend pages that require UI fixes and API integration updates.
- : The directory containing the new Android SMS forwarder project.

**Areas that need refactoring**:
- **Backend:** The entire  file must be rewritten into  to incorporate all new requirements, including integer currency, unified orders, and improved security checks.
- **Frontend:** Nearly all pages require a UI audit to fix readability (white-on-white text) and design consistency issues. Pages handling orders and payments (, , , , ) need to be updated to work with the new backend APIs.

**key api endpoints**
*(To be implemented in the refactor)*
- : (GET) Unified endpoint to fetch both product and wallet orders for a user.
- : (POST) Endpoint to create a  order.
- : Endpoint to handle payment verification, overpayment crediting, and status updates.
- : Full CRUD and filtering endpoints for admin order management.
- : Endpoint to fetch items needing manual review.
- : Endpoint for new sales and wallet analytics.

**Critical Info for New Agent**
- **Single Source of Truth:** The user's message () is now the definitive product requirements document. Adhere to it strictly.
- **Refactor First:** The immediate and highest priority task is to implement the full backend logic in the new  file. The application is non-functional until this is complete.
- **Integer Currency:** The shift to integer-based currency (paisa/cents) for all financial data is a critical and non-negotiable architectural change.
- **Phased Approach:** Complete the backend refactor first, ensure it's stable, and then proceed to the frontend overhaul. Do not attempt to do both simultaneously.

**documents and test reports created in this job**
- 
- 
-  and all other project files in that directory.

**Last 10 User Messages and any pending HUMAN messages**
1.  **User:** Asks to create the Android SMS forwarder app. (Agent created the full project structure).
2.  **User:** Provides a massive, detailed audit and refactoring request for the entire application, outlining all required backend and frontend changes. This is the new master plan.
3.  **User:** (Implicit approval to start the audit) The agent acknowledges the task and begins by exploring the codebase.
4.  **Agent:** Starts the major refactor by creating .
5.  **Agent:** Prepares to replace the old server file with the new one. This was the last action.

**Project Health Check:**
- **Broken/In-Refactor:** The backend is in a critical transitional state. A new, empty  has been created to replace the existing . The application is not functional and requires the refactor to be completed before any part of it can work.

**3rd Party Integrations**
- **Playwright-stealth:** Used for Garena web automation.

**Testing status**
- **Testing agent used after significant changes:** YES (but before the latest major refactoring request).
- **Troubleshoot agent used after agent stuck in loop:** NO.
- **Test files created:**
    - 
    - 
- **Known regressions:** The entire application is non-functional pending the completion of the backend refactor. The previously passed tests are no longer valid.

**Credentials to test flow:**
- **Admin:**  /  (or )
- **Client:**  / 
- These are created by the  script.

**What agent forgot to execute**
- The agent has just started the comprehensive refactoring task outlined by the user. The primary pending execution is to implement the entirety of the user's requirements from .</analysis>
